# HTTPS
## 一. 什么是HTTPS
HTTPS是在HTTP上建立SSL加密层，对传输数据进行加密，是HTTP协议的安全版

## 二. 为什么需要HTTPS
HTTP协议存在的问题
- 通信使用明文（不加密），内容可能被窃取
- 无法验证报文的完整性，所以可能被篡改
- 无法验证通行方的身份，因此可能被伪装

HTTPS协议的优势
- 数据隐私性: 内容经过对称加密，每个连接生成一个唯一的加密密钥
- 数据完整性: 内容传输经过完整性验证
- 身份认证: 第三方无法伪造服务端/客户端身份

## 三. HTTPS如何解决HTTP存在的问题
所谓HTTPS，其实就是套了SSL协议这层外壳的HTTP。

![1576301695020.jpg](https://s2.loli.net/2024/12/05/Qeu74kl5f6LNXwJ.jpg)

HTTPS协议的主要功能基本都依赖于`TLS/SSL`协议，`TLS/SSL`的功能实现主要依赖于三类基本算法: 散列函数、对称加密和非对称加密，其利用数字证书实现身份认证，用非对称加密协商密钥，用协商密钥对数据采用对称加密算法进行加密，用散列函数验证信息的完整性。

![1576301729282.jpg](https://s2.loli.net/2024/12/05/fylwSXDvmQnGd9J.jpg)

- 解决通信方身份被伪造的问题

  数字证书认证机构的业务流程：
  - 服务器的运营人员向第三方机构CA提交公钥，组织信息，个人信息等并申请认证
  - CA通过线上或线下等多种手段验证申请者提供信息的真实性，如组织是否存在，企业是否合法，是否拥有域名所有权等
  - 如信息审核通过，CA会向申请者签发认证文件，即证书。证书包含以下信息: 申请者公钥，申请者的组织信息和个人信息，签发机构CA的信息，有效时间，证书序列号等明文信息，同时包含一个签名，其中签名的生成算法: 首先，使用散列函数计算公开信息的信息摘要，然后使用CA的私钥进行加密，密文即签名。
  - 客户端向服务端发出请求时，服务端返回证书文件
  - 客户端读取证书中的明文信息，采用相同的散列函数计算得到摘要信息后，然后使用CA的公钥解密签名数据，比对两者的摘要信息，如果一致，则可以确认证书的合法性，即服务器的公开密钥是可信的
  - 客户端还会验证证书相关的域名信息，有效时间等
  - 客户端会内置信任CA的证书信息（包括公钥），如果CA不被信任，找不到对应的CA证书，证书也会被判定非法

- 解决内容被窃听的问题
  - 对称加密

    通信双方使用密钥加密的方式进行通信，优点是效率高，缺点是如何保证密钥的安全性。

  - 非对称加密

    使用一对非对称密钥，一把叫公开密钥，一把叫私有密钥，一方使用对方的公开密钥进行加密后，对方可以用私钥进行解密。

    缺点：非对称加密在数据加密解密过程需要消耗一定的时间，降低了数据传输效率。  

  - 对称加密 + 非对称加密

    发送对称密钥的一方使用对方的公钥进行加密处理，对方使用私钥进行解密拿到对成密钥，这样可以在确保交换的密钥安全的前提下，使用对称加密进行通行。

- 解决报文可能被篡改的问题

  数字签名: 能确认消息确实是由发送方签名并发出，也能确认消息的完整性，证明数据是否被篡改过

  数字签名生成

  ![1576306557433.jpg](https://s2.loli.net/2024/12/05/TdFlCY5ftRQ7wEs.jpg)

  数字签名验证流程
  
  ![1576306763878.jpg](https://s2.loli.net/2024/12/05/VmF3L5AKwkGsh4i.jpg)

  接收方用发送方的公钥才能解密的摘要信息与用哈希函数对收到的原文产生的摘要信息进行比对，如果相同，说明信息是完整的没有被篡改

## 四. HTTPS的工作流程
![1576308439255.jpg](https://s2.loli.net/2024/12/05/cAd7fmZUgJFHtoq.jpg)

- 客户端发起一个HTTPS请求
- 服务端返回公钥证书
- 客户端验证公钥证书，验证通过则继续
- 客户端生成对称密钥，使用公钥进行加密，发送给服务端
- 服务端用私钥解密拿到对称密钥
- 客户端和服务端采用对称加密的方式进行通信